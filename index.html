<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Gjuha Shqipe - Klasa 3</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
      background-color: #f0f9ff; 
      margin: 0; padding: 20px; 
      display: flex; justify-content: center; align-items: flex-start; min-height: 100vh;
      touch-action: manipulation;
      color: #333;
    }
    #app { 
      background: white; padding: 30px; border-radius: 24px; 
      box-shadow: 0 12px 35px rgba(0,0,0,0.08); 
      width: 100%; max-width: 700px; text-align: center;
      margin-top: 20px;
    }
    h1 { color: #0277bd; font-size: 32px; margin-bottom: 10px; }
    h2 { color: #01579b; font-size: 26px; }
    p { font-size: 18px; color: #555; line-height: 1.5; }
    
    /* Buttons */
    button { 
      padding: 20px; font-size: 22px; border: 3px solid #0288d1; 
      background-color: #fff; color: #0288d1; border-radius: 16px; 
      cursor: pointer; transition: all 0.2s ease;
      -webkit-tap-highlight-color: transparent;
      width: 100%; margin-bottom: 15px; font-weight: bold;
    }
    button:active { transform: scale(0.97); }
    .btn-primary { background-color: #0288d1; color: white; }
    .btn-secondary { background-color: #ff9800; border-color: #ff9800; color: white; }
    .btn-advanced { background-color: #9c27b0; border-color: #9c27b0; color: white; }
    .btn-back { background-color: #e0e0e0; border-color: #e0e0e0; color: #333; margin-top: 20px; }
    
    /* Quiz Options */
    .correct { background-color: #4caf50 !important; color: white !important; border-color: #4caf50 !important; }
    .wrong { background-color: #f44336 !important; color: white !important; border-color: #f44336 !important; }
    
    /* Lessons */
    .lesson-card {
      background-color: #e1f5fe; border-left: 6px solid #0288d1;
      padding: 20px; margin-bottom: 20px; border-radius: 12px;
      text-align: left;
    }
    .lesson-card h3 { margin-top: 0; color: #01579b; font-size: 22px; }
    .lesson-card p { font-size: 20px; margin-bottom: 0; }

    /* Advanced Test Styles */
    .advanced-section {
      background: #f3e5f5; padding: 20px; border-radius: 12px;
      margin-bottom: 25px; text-align: left; border-left: 6px solid #9c27b0;
    }
    .advanced-section h3 { color: #6a1b9a; font-size: 20px; margin-top: 0; }
    .text-box { background: #fff; padding: 15px; border-radius: 8px; font-size: 22px; color: #000; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); }
    .adv-row { margin-bottom: 15px; background: rgba(255,255,255,0.6); padding: 15px; border-radius: 8px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    .adv-row label { font-weight: bold; font-size: 18px; width: 100%; margin-bottom: 5px; color: #333; }
    
    input[type="text"], select {
      padding: 15px; font-size: 18px; border: 2px solid #ce93d8; border-radius: 10px;
      flex: 1; min-width: 140px; font-family: inherit;
    }
    input[type="text"]:focus, select:focus { outline: none; border-color: #9c27b0; box-shadow: 0 0 8px rgba(156,39,176,0.3); }
    .open-input { width: 100%; margin-bottom: 15px; display: block; }
    .hint { font-size: 15px; color: #666; font-style: italic; margin-bottom: 10px; display: block; }

    #progress { color: #757575; font-size: 18px; margin-bottom: 15px; font-weight: bold; }
    .question { font-size: 26px; margin-bottom: 30px; color: #222; font-weight: bold; }
    
    /* Screen Management */
    .screen { display: none; }
    .screen.active { display: block; }
  </style>
</head>
<body>

<div id="app">
  
  <div id="screen-home" class="screen active">
    <h1>PÃ«rshÃ«ndetje, Noar! ğŸ‘‹</h1>
    <p>MirÃ« se erdhe nÃ« aplikacionin e GjuhÃ«s Shqipe.</p>
    <br>
    <button class="btn-primary" onclick="showScreen('screen-lessons')">ğŸ“– Lexo MÃ«simet</button>
    <button class="btn-secondary" onclick="showScreen('screen-tests')">âœï¸ Fillo Testet</button>
  </div>

  <div id="screen-lessons" class="screen">
    <h2>MÃ«simet e GramatikÃ«s</h2>
    <div id="lessons-container">
      <div class="lesson-card">
        <h3>1. Emri Konkret dhe Abstrakt</h3>
        <p><b>Konkret:</b> Mund ta shohim dhe ta prekim (Tavolina, Lapsi, Molla).<br>
        <b>Abstrakt:</b> Nuk e prekim dot, tregon ndjenja ose mendime (GÃ«zimi, Frika, Dashuria).</p>
      </div>
      <div class="lesson-card">
        <h3>2. Gjinia e Emrit</h3>
        <p><b>Mashkullore:</b> mbarojnÃ« me <b>-i</b> ose <b>-u</b> (Gjyshi, Zogu).<br>
        <b>FemÃ«rore:</b> mbarojnÃ« me <b>-a</b> ose <b>-ja</b> (Gjyshja, Vajza).</p>
      </div>
      <div class="lesson-card">
        <h3>3. Numri i Emrit</h3>
        <p><b>NjÃ«jÃ«s:</b> tregon vetÃ«m njÃ« (Libri).<br>
        <b>ShumÃ«s:</b> tregon dy ose mÃ« shumÃ« (Librat).</p>
      </div>
    </div>
    <button class="btn-back" onclick="showScreen('screen-home')">â¬… Kthehu nÃ« BallinÃ«</button>
  </div>

  <div id="screen-tests" class="screen">
    <h2>Zgjidh njÃ« Test</h2>
    <button class="btn-advanced" onclick="showScreen('screen-advanced')">ğŸŒŸ Testi i Avancuar (Me Shkrim) ğŸŒŸ</button>
    <hr style="margin: 20px 0; border: 1px solid #eee;">
    <div id="test-buttons-container"></div>
    <button class="btn-back" onclick="showScreen('screen-home')">â¬… Kthehu nÃ« BallinÃ«</button>
  </div>

  <div id="screen-advanced" class="screen">
    <h2>Testi i Avancuar</h2>
    <p>PÃ«rdor lapsin tÃ«nd (Apple Pencil) pÃ«r tÃ« shkruar nÃ« kutitÃ« e bardha ose zgjidh opsionin e saktÃ«!</p>

    <div class="advanced-section">
      <h3>1. Lexo tekstin dhe kthe emrat.</h3>
      <p class="text-box">"<b>MÃ«suesi</b> i lavdÃ«roi nxÃ«nÃ«sit. Ai foli edhe me <b>gjyshin</b> e njÃ«rit prej tyre."</p>
      
      <div class="adv-row">
        <label>Fjala "MÃ«suesi":</label>
        <select id="adv-q1-num"><option value="">--Numri--</option><option value="NjÃ«jÃ«s">NjÃ«jÃ«s</option><option value="ShumÃ«s">ShumÃ«s</option></select>
        <select id="adv-q1-gjin"><option value="">--Gjinia--</option><option value="Mashkullore">Mashkullore</option><option value="FemÃ«rore">FemÃ«rore</option></select>
        <input type="text" id="adv-q1-kthe" placeholder="Ktheje nÃ« FemÃ«rore...">
      </div>

      <div class="adv-row">
        <label>Fjala "Gjyshin" (Gjyshi):</label>
        <select id="adv-q2-num"><option value="">--Numri--</option><option value="NjÃ«jÃ«s">NjÃ«jÃ«s</option><option value="ShumÃ«s">ShumÃ«s</option></select>
        <select id="adv-q2-gjin"><option value="">--Gjinia--</option><option value="Mashkullore">Mashkullore</option><option value="FemÃ«rore">FemÃ«rore</option></select>
        <input type="text" id="adv-q2-kthe" placeholder="Ktheje nÃ« FemÃ«rore...">
      </div>
    </div>

    <div class="advanced-section">
      <h3>2. Shkruaj shumÃ«sin dhe trego gjininÃ«.</h3>
      <div class="adv-row">
        <label>Fjala: Libri</label>
        <input type="text" id="adv-q3-shumes" placeholder="Shkruaj shumÃ«sin...">
        <select id="adv-q3-gjin"><option value="">--Gjinia nÃ« njÃ«jÃ«s--</option><option value="Mashkullore">Mashkullore</option><option value="FemÃ«rore">FemÃ«rore</option></select>
      </div>
      <div class="adv-row">
        <label>Fjala: Lulja</label>
        <input type="text" id="adv-q4-shumes" placeholder="Shkruaj shumÃ«sin...">
        <select id="adv-q4-gjin"><option value="">--Gjinia nÃ« njÃ«jÃ«s--</option><option value="Mashkullore">Mashkullore</option><option value="FemÃ«rore">FemÃ«rore</option></select>
      </div>
    </div>

    <div class="advanced-section">
      <h3>3. Emrat KonkretÃ«</h3>
      <span class="hint">Shkruaj 3 emra qÃ« mund t'i shohÃ«sh dhe t'i prekÃ«sh (psh. dera, lapsi).</span>
      <input type="text" class="open-input" placeholder="1. EmÃ«r konkret">
      <input type="text" class="open-input" placeholder="2. EmÃ«r konkret">
      <input type="text" class="open-input" placeholder="3. EmÃ«r konkret">
    </div>

    <div class="advanced-section">
      <h3>4. Emrat AbstraktÃ«</h3>
      <span class="hint">Shkruaj 3 emra qÃ« tregojnÃ« ndjenja ose ide (psh. gÃ«zimi, frika).</span>
      <input type="text" class="open-input" placeholder="1. EmÃ«r abstrakt">
      <input type="text" class="open-input" placeholder="2. EmÃ«r abstrakt">
      <input type="text" class="open-input" placeholder="3. EmÃ«r abstrakt">
    </div>

    <button class="btn-advanced" onclick="checkAdvancedTest()">KONTROLLO TESTIN</button>
    <button class="btn-back" onclick="showScreen('screen-tests')">â¬… Kthehu mbrapa</button>
  </div>

  <div id="screen-quiz" class="screen">
    <h2 id="quiz-title">Testi</h2>
    <div id="progress">Pyetja 1 / 5</div>
    <div class="question" id="question">Loading...</div>
    <div id="options"></div>
    <button class="btn-secondary" id="next-btn" onclick="nextQuestion()" style="display:none; margin-top:25px;">Vazhdo te pyetja tjetÃ«r â¡</button>
    <button class="btn-back" onclick="showScreen('screen-tests')">â¬… NdÃ«rprit Testin</button>
  </div>

  <div id="screen-score" class="screen">
    <h2>Testi PÃ«rfundoi!</h2>
    <h1 id="score-text" style="font-size: 48px; margin: 20px 0;"></h1>
    <p id="score-message" style="font-size: 20px; font-weight: normal; line-height: 1.6;"></p>
    <br>
    <button class="btn-primary" onclick="showScreen('screen-tests')">Zgjidh njÃ« Test TjetÃ«r</button>
    <button class="btn-back" onclick="showScreen('screen-home')">Kthehu nÃ« BallinÃ«</button>
  </div>

</div>

<script>
  // Regular Tests Data
  const testsData = [
    {
      name: "Testi 1: Ã‡farÃ« Ã«shtÃ« Emri?",
      questions: [
        { q: "Cila fjalÃ« tregon NJERI?", options: ["Lapsi", "MÃ«suesja", "Tavolina"], a: "MÃ«suesja" },
        { q: "Cila fjalÃ« tregon KAFSHÃ‹?", options: ["ShtÃ«pia", "Macja", "GÃ«zimi"], a: "Macja" },