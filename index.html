<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Gjuha Shqipe - Klasa 3</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
      background-color: #f0f9ff; 
      margin: 0; padding: 20px; 
      display: flex; justify-content: center; align-items: flex-start; min-height: 100vh;
      touch-action: manipulation;
      color: #333;
    }
    #app { 
      background: white; padding: 30px; border-radius: 24px; 
      box-shadow: 0 12px 35px rgba(0,0,0,0.08); 
      width: 100%; max-width: 700px; text-align: center;
      margin-top: 20px;
    }
    h1 { color: #0277bd; font-size: 32px; margin-bottom: 10px; }
    h2 { color: #01579b; font-size: 26px; }
    p { font-size: 18px; color: #555; line-height: 1.5; }
    
    /* Buttons */
    button { 
      padding: 20px; font-size: 22px; border: 3px solid #0288d1; 
      background-color: #fff; color: #0288d1; border-radius: 16px; 
      cursor: pointer; transition: all 0.2s ease;
      -webkit-tap-highlight-color: transparent;
      width: 100%; margin-bottom: 15px; font-weight: bold;
    }
    button:active { transform: scale(0.97); }
    .btn-primary { background-color: #0288d1; color: white; }
    .btn-secondary { background-color: #ff9800; border-color: #ff9800; color: white; }
    .btn-advanced { background-color: #9c27b0; border-color: #9c27b0; color: white; }
    .btn-back { background-color: #e0e0e0; border-color: #e0e0e0; color: #333; margin-top: 20px; }
    
    /* Quiz Options */
    .correct { background-color: #4caf50 !important; color: white !important; border-color: #4caf50 !important; }
    .wrong { background-color: #f44336 !important; color: white !important; border-color: #f44336 !important; }
    
    /* Lessons */
    .lesson-card {
      background-color: #e1f5fe; border-left: 6px solid #0288d1;
      padding: 20px; margin-bottom: 20px; border-radius: 12px;
      text-align: left;
    }
    .lesson-card h3 { margin-top: 0; color: #01579b; font-size: 22px; }
    .lesson-card p { font-size: 20px; margin-bottom: 0; }

    /* Advanced Test Styles */
    .advanced-section {
      background: #f3e5f5; padding: 20px; border-radius: 12px;
      margin-bottom: 25px; text-align: left; border-left: 6px solid #9c27b0;
    }
    .advanced-section h3 { color: #6a1b9a; font-size: 20px; margin-top: 0; }
    .text-box { background: #fff; padding: 15px; border-radius: 8px; font-size: 22px; color: #000; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); }
    .adv-row { margin-bottom: 15px; background: rgba(255,255,255,0.6); padding: 15px; border-radius: 8px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    .adv-row label { font-weight: bold; font-size: 18px; width: 100%; margin-bottom: 5px; color: #333; }
    
    input[type="text"], select {
      padding: 15px; font-size: 18px; border: 2px solid #ce93d8; border-radius: 10px;
      flex: 1; min-width: 140px; font-family: inherit;
    }
    input[type="text"]:focus, select:focus { outline: none; border-color: #9c27b0; box-shadow: 0 0 8px rgba(156,39,176,0.3); }
    .open-input { width: 100%; margin-bottom: 15px; display: block; }
    .hint { font-size: 15px; color: #666; font-style: italic; margin-bottom: 10px; display: block; }

    #progress { color: #757575; font-size: 18px; margin-bottom: 15px; font-weight: bold; }
    .question { font-size: 26px; margin-bottom: 30px; color: #222; font-weight: bold; }
    
    /* Screen Management */
    .screen { display: none; }
    .screen.active { display: block; }
  </style>
</head>
<body>

<div id="app">
  
  <div id="screen-home" class="screen active">
    <h1>PÃ«rshÃ«ndetje, Noar! ğŸ‘‹</h1>
    <p>MirÃ« se erdhe nÃ« aplikacionin e GjuhÃ«s Shqipe.</p>
    <br>
    <button class="btn-primary" onclick="showScreen('screen-lessons')">ğŸ“– Lexo MÃ«simet</button>
    <button class="btn-secondary" onclick="showScreen('screen-tests')">âœï¸ Fillo Testet</button>
  </div>

  <div id="screen-lessons" class="screen">
    <h2>MÃ«simet e GramatikÃ«s</h2>
    <div id="lessons-container">
      <div class="lesson-card">
        <h3>1. Emri Konkret dhe Abstrakt</h3>
        <p><b>Konkret:</b> Mund ta shohim dhe ta prekim (Tavolina, Lapsi, Molla).<br>
        <b>Abstrakt:</b> Nuk e prekim dot, tregon ndjenja ose mendime (GÃ«zimi, Frika, Dashuria).</p>
      </div>
      <div class="lesson-card">
        <h3>2. Gjinia e Emrit</h3>
        <p><b>Mashkullore:</b> mbarojnÃ« me <b>-i</b> ose <b>-u</b> (Gjyshi, Zogu).<br>
        <b>FemÃ«rore:</b> mbarojnÃ« me <b>-a</b> ose <b>-ja</b> (Gjyshja, Vajza).</p>
      </div>
      <div class="lesson-card">
        <h3>3. Numri i Emrit</h3>
        <p><b>NjÃ«jÃ«s:</b> tregon vetÃ«m njÃ« (Libri).<br>
        <b>ShumÃ«s:</b> tregon dy ose mÃ« shumÃ« (Librat).</p>
      </div>
    </div>
    <button class="btn-back" onclick="showScreen('screen-home')">â¬… Kthehu nÃ« BallinÃ«</button>
  </div>

  <div id="screen-tests" class="screen">
    <h2>Zgjidh njÃ« Test</h2>
    <button class="btn-advanced" onclick="showScreen('screen-advanced')">ğŸŒŸ Testi i Avancuar (Me Shkrim) ğŸŒŸ</button>
    <hr style="margin: 20px 0; border: 1px solid #eee;">
    <div id="test-buttons-container"></div>
    <button class="btn-back" onclick="showScreen('screen-home')">â¬… Kthehu nÃ« BallinÃ«</button>
  </div>

  <div id="screen-advanced" class="screen">
    <h2>Testi i Avancuar</h2>
    <p>PÃ«rdor lapsin tÃ«nd pÃ«r tÃ« shkruar nÃ« kutitÃ« e bardha ose zgjidh opsionin e saktÃ«!</p>

    <div class="advanced-section">
      <h3>1. Lexo tekstin dhe kthe emrat.</h3>
      <p class="text-box">"<b>MÃ«suesi</b> i lavdÃ«roi nxÃ«nÃ«sit. Ai foli edhe me <b>gjyshin</b> e njÃ«rit prej tyre."</p>
      
      <div class="adv-row">
        <label>Fjala "MÃ«suesi":</label>
        <select id="adv-q1-num"><option value="">--Numri--</option><option value="NjÃ«jÃ«s">NjÃ«jÃ«s</option><option value="ShumÃ«s">ShumÃ«s</option></select>
        <select id="adv-q1-gjin"><option value="">--Gjinia--</option><option value="Mashkullore">Mashkullore</option><option value="FemÃ«rore">FemÃ«rore</option></select>
        <input type="text" id="adv-q1-kthe" placeholder="Ktheje nÃ« FemÃ«rore...">
      </div>

      <div class="adv-row">
        <label>Fjala "Gjyshin" (Gjyshi):</label>
        <select id="adv-q2-num"><option value="">--Numri--</option><option value="NjÃ«jÃ«s">NjÃ«jÃ«s</option><option value="ShumÃ«s">ShumÃ«s</option></select>
        <select id="adv-q2-gjin"><option value="">--Gjinia--</option><option value="Mashkullore">Mashkullore</option><option value="FemÃ«rore">FemÃ«rore</option></select>
        <input type="text" id="adv-q2-kthe" placeholder="Ktheje nÃ« FemÃ«rore...">
      </div>
    </div>

    <div class="advanced-section">
      <h3>2. Shkruaj shumÃ«sin dhe trego gjininÃ«.</h3>
      <div class="adv-row">
        <label>Fjala: Libri</label>
        <input type="text" id="adv-q3-shumes" placeholder="Shkruaj shumÃ«sin...">
        <select id="adv-q3-gjin"><option value="">--Gjinia nÃ« njÃ«jÃ«s--</option><option value="Mashkullore">Mashkullore</option><option value="FemÃ«rore">FemÃ«rore</option></select>
      </div>
      <div class="adv-row">
        <label>Fjala: Lulja</label>
        <input type="text" id="adv-q4-shumes" placeholder="Shkruaj shumÃ«sin...">
        <select id="adv-q4-gjin"><option value="">--Gjinia nÃ« njÃ«jÃ«s--</option><option value="Mashkullore">Mashkullore</option><option value="FemÃ«rore">FemÃ«rore</option></select>
      </div>
    </div>

    <div class="advanced-section">
      <h3>3. Emrat KonkretÃ«</h3>
      <span class="hint">Shkruaj 3 emra qÃ« mund t'i shohÃ«sh dhe t'i prekÃ«sh (psh. dera, lapsi).</span>
      <input type="text" class="open-input" placeholder="1. EmÃ«r konkret">
      <input type="text" class="open-input" placeholder="2. EmÃ«r konkret">
      <input type="text" class="open-input" placeholder="3. EmÃ«r konkret">
    </div>

    <div class="advanced-section">
      <h3>4. Emrat AbstraktÃ«</h3>
      <span class="hint">Shkruaj 3 emra qÃ« tregojnÃ« ndjenja ose ide (psh. gÃ«zimi, frika).</span>
      <input type="text" class="open-input" placeholder="1. EmÃ«r abstrakt">
      <input type="text" class="open-input" placeholder="2. EmÃ«r abstrakt">
      <input type="text" class="open-input" placeholder="3. EmÃ«r abstrakt">
    </div>

    <button class="btn-advanced" onclick="checkAdvancedTest()">KONTROLLO TESTIN</button>
    <button class="btn-back" onclick="showScreen('screen-tests')">â¬… Kthehu mbrapa</button>
  </div>

  <div id="screen-quiz" class="screen">
    <h2 id="quiz-title">Testi</h2>
    <div id="progress">Pyetja 1 / 5</div>
    <div class="question" id="question">Loading...</div>
    <div id="options"></div>
    <button class="btn-secondary" id="next-btn" onclick="nextQuestion()" style="display:none; margin-top:25px;">Vazhdo te pyetja tjetÃ«r â¡</button>
    <button class="btn-back" onclick="showScreen('screen-tests')">â¬… NdÃ«rprit Testin</button>
  </div>

  <div id="screen-score" class="screen">
    <h2>Testi PÃ«rfundoi!</h2>
    <h1 id="score-text" style="font-size: 48px; margin: 20px 0;"></h1>
    <p id="score-message" style="font-size: 20px; font-weight: normal; line-height: 1.6;"></p>
    <br>
    <button class="btn-primary" onclick="showScreen('screen-tests')">Zgjidh njÃ« Test TjetÃ«r</button>
    <button class="btn-back" onclick="showScreen('screen-home')">Kthehu nÃ« BallinÃ«</button>
  </div>

</div>

<script>
  // 1. Core Functions (Loaded first to prevent ReferenceErrors)
  function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(screenId).classList.add('active');
  }

  // App State Variables
  let activeTestIndex = 0;
  let currentQuestionIndex = 0;
  let score = 0;

  function startTest(index) {
    activeTestIndex = index;
    currentQuestionIndex = 0;
    score = 0;
    document.getElementById('quiz-title').innerText = testsData[index].name;
    showScreen('screen-quiz');
    loadQuestion();
  }

  function loadQuestion() {
    const nextBtn = document.getElementById('next-btn');
    nextBtn.style.display = 'none';
    const test = testsData[activeTestIndex];
    const currentQ = test.questions[currentQuestionIndex];
    document.getElementById('progress').innerText = `Pyetja ${currentQuestionIndex + 1} nga ${test.questions.length}`;
    document.getElementById('question').innerText = currentQ.q;
    const optionsEl = document.getElementById('options');
    optionsEl.innerHTML = '';
    currentQ.options.forEach(option => {
      const btn = document.createElement('button');
      btn.innerText = option;
      btn.onclick = () => selectAnswer(btn, option, currentQ.a);
      optionsEl.appendChild(btn);
    });
  }

  function selectAnswer(selectedBtn, selectedText, correctText) {
    const allBtns = document.getElementById('options').querySelectorAll('button');
    allBtns.forEach(btn => btn.disabled = true);
    if (selectedText === correctText) {
      selectedBtn.classList.add('correct');
      score++;
    } else {
      selectedBtn.classList.add('wrong');
      allBtns.forEach(btn => { if (btn.innerText === correctText) btn.classList.add('correct'); });
    }
    document.getElementById('next-btn').style.display = 'block';
  }

  function nextQuestion() {
    const test = testsData[activeTestIndex];
    currentQuestionIndex++;
    if (currentQuestionIndex < test.questions.length) { 
      loadQuestion(); 
    } else { 
      showFinalScore(test.questions.length); 
    }
  }

  function showFinalScore(total) {
    document.getElementById('score-text').innerText = `${score} / ${total}`;
    const msgEl = document.getElementById('score-message');
    if(score === total) {
      msgEl.innerHTML = "<b>TÃ« lumtÃ« Noar! Je i shkÃ«lqyer! ğŸŒŸğŸ†</b>";
    } else {
      msgEl.innerHTML = "<b>ShumÃ« mirÃ«! Provo sÃ«rish pÃ«r t'u bÃ«rÃ« kampion! ğŸ‘</b>";
    }
    showScreen('screen-score');
  }

  function checkAdvancedTest() {
    let advScore = 0;
    const maxAdvScore = 10; 

    if(document.getElementById('adv-q1-num').value === 'NjÃ«jÃ«s') advScore++;
    if(document.getElementById('adv-q1-gjin').value === 'Mashkullore') advScore++;
    let kthe1 = document.getElementById('adv-q1-kthe').value.trim().toLowerCase();
    if(kthe1 === 'mÃ«suesja' || kthe1 === 'mesuesja') advScore++;

    if(document.getElementById('adv-q2-num').value === 'NjÃ«jÃ«s') advScore++;
    if(document.getElementById('adv-q2-gjin').value === 'Mashkullore') advScore++;
    let kthe2 = document.getElementById('adv-q2-kthe').value.trim().toLowerCase();
    if(kthe2 === 'gjyshen' || kthe2 === 'gjyshja') advScore++;

    let shum3 = document.getElementById('adv-q3-shumes').value.trim().toLowerCase();
    if(shum3 === 'librat') advScore++;
    if(document.getElementById('adv-q3-gjin').value === 'Mashkullore') advScore++;

    let shum4 = document.getElementById('adv-q4-shumes').value.trim().toLowerCase();
    if(shum4 === 'lulet' || shum4 === 'lulet') advScore++;
    if(document.getElementById('adv-q4-gjin').value === 'FemÃ«rore') advScore++;

    let openFilled = 0;
    document.querySelectorAll('.open-input').forEach(inp => {
      if(inp.value.trim().length >= 2) openFilled++;
    });

    document.getElementById('score-text').innerText = `${advScore} / ${maxAdvScore} PikÃ«`;
    document.getElementById('score-message').innerHTML = `
      <b style="color: #0288d1;">Keni marrÃ« ${advScore} nga 10 pikÃ« nÃ« pyetjet e rregullave!</b><br><br>
      PÃ«r emrat konkretÃ« dhe abstraktÃ«, keni shkruar <b>${openFilled} fjalÃ«</b> nga 6 tÃ« mundshme.<br><br>
      <span style="color: #e65100; font-weight: bold;">âš ï¸ Tregoja prindit iPad-in tani, qÃ« ai tÃ« kontrollojÃ« nÃ«se emrat konkretÃ« dhe abstraktÃ« qÃ« shkruajte me laps janÃ« tÃ« saktÃ«!</span>
    `;
    
    document.querySelectorAll('input[type="text"]').forEach(el => el.value = '');
    document.querySelectorAll('select').forEach(el => el.value = '');
    
    showScreen('screen-score');
  }

  // 2. Regular Tests Data
  const testsData = [
    {
      name: "Testi 1: Ã‡farÃ« Ã«shtÃ« Emri?",
      questions: [
        { q: "Cila fjalÃ« tregon NJERI?", options: ["Lapsi", "MÃ«suesja", "Tavolina"], a: "MÃ«suesja" },
        { q: "Cila fjalÃ« tregon KAFSHÃ‹?", options: ["ShtÃ«pia", "Macja", "GÃ«zimi"], a: "Macja" },
        { q: "Si shkruhet emri i njÃ« qyteti (EmÃ«r i PÃ«rveÃ§Ã«m)?", options: ["prishtina", "Prishtina", "PRISHTiNa"], a: "Prishtina" }
      ]
    },
    {
      name: "Testi 2: Gjej Mbiemrin",
      questions: [
        { q: "Cila fjalÃ« tregon njÃ« CILÃ‹SI (MbiemÃ«r)?", options: ["Libri", "Lexoj", "I menÃ§ur"], a: "I menÃ§ur" },
        { q: "Gjej mbiemrin nÃ« fjalinÃ«: 'Qielli Ã«shtÃ« i kaltÃ«r.'", options: ["Qielli", "Ã«shtÃ«", "i kaltÃ«r"], a: "i kaltÃ«r" },
        { q: "Zgjidh mbiemrin e duhur: 'MollÃ« ______'", options: ["e kuqe", "i kuq", "tÃ« kuqe"], a: "e kuqe" }
      ]
    },
    {
      name: "Testi 3: Gjinia dhe Numri",
      questions: [
        { q: "Emri 'Vajza' Ã«shtÃ« nÃ« gjininÃ«:", options: ["Mashkullore", "FemÃ«rore"], a: "FemÃ«rore" },
        { q: "Emri 'Librat' Ã«shtÃ« nÃ« numrin:", options: ["NjÃ«jÃ«s", "ShumÃ«s"], a: "ShumÃ«s" },
        { q: "Numri NjÃ«jÃ«s i fjalÃ«s 'ZogjtÃ«' Ã«shtÃ«:", options: ["Zog", "Zogu", "Zogut"], a: "Zogu" }
      ]
    }
  ];

  // 3. Setup Interface Once Page Loads Safely
  window.onload = function() {
    const testMenuContainer = document.getElementById('test-buttons-container');
    if (testMenuContainer) {
      testMenuContainer.innerHTML = ''; // Clear container to avoid duplicates
      testsData.forEach((test, index) => {
        const btn = document.createElement('button');
        btn.innerText = test.name;
        btn.onclick = () => startTest(index);
        testMenuContainer.appendChild(btn);
      });
    }
  };
</script>
</body>
</html>